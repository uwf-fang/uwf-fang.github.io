
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Memory Management in Classes &#8212; IanFang Course Note Hosting  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/nature.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="canonical" href="https://uwf-fang.github.io/cpp/memory-man/memory-man-class.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Operator Overloading" href="../op-overload.html" />
    <link rel="prev" title="Chapter 9 Memory Management in Classes" href="../../course/cop3014/ch09.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../op-overload.html" title="Operator Overloading"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../../course/cop3014/ch09.html" title="Chapter 9 Memory Management in Classes"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">IanFang Course Note Hosting  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../course/cop3014/index.html" >COP 3014 Algorithm and Program Design</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../course/cop3014/ch09.html" accesskey="U">Chapter 9 Memory Management in Classes</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Memory Management in Classes</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="memory-management-in-classes">
<h1>Memory Management in Classes<a class="headerlink" href="#memory-management-in-classes" title="Permalink to this headline">¶</a></h1>
<section id="dynamic-data-in-class">
<h2>Dynamic data in class<a class="headerlink" href="#dynamic-data-in-class" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>pointer-typed instance variables</p>
<ul>
<li><p>holding a single value or an array</p></li>
<li><p>allocated using <code class="docutils literal notranslate"><span class="pre">new</span></code> or passed in as parameters</p></li>
</ul>
</li>
<li><p>Potential memory problems</p>
<ul>
<li><p>memory leak - fail to <code class="docutils literal notranslate"><span class="pre">delete</span></code></p>
<ul>
<li><p>bad or no destructor</p></li>
<li><p>dynamic data passed around without correct handling</p></li>
</ul>
</li>
<li><p>shallow copy - fail to copy the dynamic data in the heap memory</p>
<ul>
<li><p>only the memory address are copied by default constructor/assignment</p></li>
<li><p>bad or no copy constructor</p></li>
<li><p>bad or no copy assignment operator overload</p></li>
<li><p><strong>may not be a problem if objects are never copied or copy assigned</strong></p></li>
<li><p>will consequently cause the destructor to <code class="docutils literal notranslate"><span class="pre">delete</span></code> a same memory
block in heap multiple times</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Rule of three</p>
<ul>
<li><p>The <strong>big three</strong> methods needed for classes with dynamic data.</p></li>
<li><p>destructor</p>
<ul>
<li><p><strong>mandatory</strong> because it will always be triggered</p></li>
<li><p>when an object is destroyed</p>
<ul>
<li><p>local object going out of scope</p></li>
<li><p>dynamic object being <code class="docutils literal notranslate"><span class="pre">delete</span></code> d</p></li>
</ul>
</li>
<li><p>place to <code class="docutils literal notranslate"><span class="pre">delete</span></code> dynamic data</p></li>
</ul>
</li>
<li><p>copy constructor</p>
<ul>
<li><p>explicit triggering <code class="docutils literal notranslate"><span class="pre">MyClass</span> <span class="pre">obj1;</span> <span class="pre">MyClass</span> <span class="pre">obj2(obj1);</span></code></p></li>
<li><p>implicit triggering</p>
<ul>
<li><p>in initialization</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MyClass</span> <span class="pre">obj1;</span> <span class="pre">MyClass</span> <span class="pre">obj2</span> <span class="pre">=</span> <span class="pre">obj1;</span></code></p></li>
</ul>
</li>
<li><p>place to perform deep copy</p></li>
</ul>
</li>
<li><p>copy assignment operator overload</p>
<ul>
<li><p>triggering <code class="docutils literal notranslate"><span class="pre">MyClass</span> <span class="pre">obj1;</span> <span class="pre">MyClass</span> <span class="pre">obj2;</span> <span class="pre">obj2</span> <span class="pre">=</span> <span class="pre">obj1;</span></code></p></li>
<li><p>implicit assignment</p>
<ul>
<li><p>parameter passing by value</p></li>
<li><p>return as value</p></li>
</ul>
</li>
<li><p>clean up old data</p></li>
<li><p>perform deep copy</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">*this;</span></code></p></li>
</ul>
</li>
<li><p>you may omit the last two if they are never triggered</p></li>
</ul>
</li>
</ul>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 2</span><span class="w"> </span><span class="k">private</span><span class="o">:</span><span class="w"></span>
<span class="linenos"> 3</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">arr</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 4</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 5</span><span class="w"> </span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w">  </span><span class="n">MyClass</span><span class="p">();</span><span class="w"></span>
<span class="linenos"> 7</span><span class="w">  </span><span class="n">MyClass</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w">  </span><span class="n">MyClass</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">MyClass</span><span class="o">&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">);</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">  </span><span class="n">MyClass</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">MyClass</span><span class="o">&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">);</span><span class="w"></span>
<span class="linenos">10</span><span class="w">  </span><span class="o">~</span><span class="n">MyClass</span><span class="p">();</span><span class="w"></span>
<span class="linenos">11</span><span class="p">}</span><span class="w"></span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="n">MyClass</span><span class="o">::</span><span class="n">MyClass</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">14</span><span class="w">  </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos">15</span><span class="w">  </span><span class="n">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"></span>
<span class="linenos">16</span><span class="p">}</span><span class="w"></span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="n">MyClass</span><span class="o">::</span><span class="n">MyClass</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">19</span><span class="w">  </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<span class="linenos">20</span><span class="w">  </span><span class="n">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="n">size</span><span class="p">];</span><span class="w"></span>
<span class="linenos">21</span><span class="p">}</span><span class="w"></span>
<span class="linenos">22</span>
<span class="linenos">23</span><span class="n">MyClass</span><span class="o">::</span><span class="n">MyClass</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">MyClass</span><span class="o">&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">24</span><span class="w">  </span><span class="c1">// you can access private member of other directly!</span>
<span class="linenos">25</span><span class="w">  </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<span class="linenos">26</span><span class="w">  </span><span class="n">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="n">size</span><span class="p">];</span><span class="w"></span>
<span class="linenos">27</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="linenos">28</span><span class="w">    </span><span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
<span class="linenos">29</span><span class="p">}</span><span class="w"></span>
<span class="linenos">30</span>
<span class="linenos">31</span><span class="n">MyClass</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyClass</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">MyClass</span><span class="o">&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">32</span><span class="w">  </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<span class="linenos">33</span><span class="w">  </span><span class="c1">// must release memory of the old dynamic data first!</span>
<span class="linenos">34</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">arr</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"></span>
<span class="linenos">35</span><span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="n">arr</span><span class="p">;</span><span class="w"></span>
<span class="linenos">36</span><span class="w">  </span><span class="n">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="n">size</span><span class="p">];</span><span class="w"></span>
<span class="linenos">37</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="linenos">38</span><span class="w">    </span><span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
<span class="linenos">39</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span><span class="w">  </span><span class="c1">// IMPORTANT! return the current object by reference</span>
<span class="linenos">40</span><span class="p">}</span><span class="w"></span>
<span class="linenos">41</span>
<span class="linenos">42</span><span class="o">~</span><span class="n">MyClass</span><span class="o">::</span><span class="n">MyClass</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">43</span><span class="w">  </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="n">arr</span><span class="p">;</span><span class="w"></span>
<span class="linenos">44</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<ul class="simple">
<li><p>Rule of five</p>
<ul>
<li><p>Two more methods</p>
<ul>
<li><p>Move constructor</p></li>
<li><p>Move assignment operator overloading</p></li>
</ul>
</li>
<li><p>Not mandatory but will improve efficiency</p></li>
<li><p>New syntax since c++ 11 using <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code></p></li>
<li><p>Mutable parameter</p></li>
</ul>
</li>
</ul>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">// the parameter is no longer &#39;const&#39; because you will modify it</span>
<span class="linenos"> 2</span><span class="n">MyClass</span><span class="o">::</span><span class="n">MyClass</span><span class="p">(</span><span class="n">MyClass</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 3</span><span class="w">  </span><span class="c1">// you can access private member of other directly!</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 5</span><span class="w">  </span><span class="n">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">arr</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w">  </span><span class="c1">// must make the other object ready for destruction</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="c1">// without this step the destructor may try to delete the moved data</span>
<span class="linenos"> 8</span><span class="w">  </span><span class="n">other</span><span class="p">.</span><span class="n">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">null</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">  </span><span class="n">other</span><span class="p">.</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos">10</span><span class="p">}</span><span class="w"></span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="c1">// the parameter is no longer &#39;const&#39; because you will modify it</span>
<span class="linenos">13</span><span class="n">MyClass</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">MyClass</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">MyClass</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">14</span><span class="w">  </span><span class="c1">// Swap both the size and arr with the other object</span>
<span class="linenos">15</span><span class="w">  </span><span class="c1">// the destructor of the other object will destroy the data</span>
<span class="linenos">16</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">tempSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<span class="linenos">17</span><span class="w">  </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<span class="linenos">18</span><span class="w">  </span><span class="n">other</span><span class="p">.</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tempSize</span><span class="p">;</span><span class="w"></span>
<span class="linenos">19</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">tempArr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arr</span><span class="p">;</span><span class="w"></span>
<span class="linenos">20</span><span class="w">  </span><span class="n">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">arr</span><span class="p">;</span><span class="w"></span>
<span class="linenos">21</span><span class="w">  </span><span class="n">other</span><span class="p">.</span><span class="n">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tempArr</span><span class="p">;</span><span class="w"></span>
<span class="linenos">22</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span><span class="w"></span>
<span class="linenos">23</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="ownership-of-dynamic-data">
<h2>Ownership of Dynamic Data<a class="headerlink" href="#ownership-of-dynamic-data" title="Permalink to this headline">¶</a></h2>
<p>A dynamic data can be created and passed. As the ownership changed. The last
owner should take the responsibility to release the memory.</p>
<p>Passing dynamic data created outside as a parameter. The recipient owns the data
after.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">class</span><span class="w"> </span><span class="nc">DataType</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 2</span><span class="w">  </span><span class="c1">// ...</span>
<span class="linenos"> 3</span><span class="p">};</span><span class="w"></span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w"> </span><span class="k">private</span><span class="o">:</span><span class="w"></span>
<span class="linenos"> 7</span><span class="w">  </span><span class="n">DataType</span><span class="w"> </span><span class="o">*</span><span class="n">myDynamicData</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w"> </span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">  </span><span class="n">MyClass</span><span class="p">(</span><span class="n">DataType</span><span class="w"> </span><span class="o">*</span><span class="n">initialData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">10</span><span class="w">    </span><span class="n">myDynamicData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">initialData</span><span class="p">;</span><span class="w"></span>
<span class="linenos">11</span><span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="linenos">12</span><span class="w">  </span><span class="o">~</span><span class="n">MyClass</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">13</span><span class="w">    </span><span class="c1">// delete here although it is not new&#39;ed in the class</span>
<span class="linenos">14</span><span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">myDynamicData</span><span class="p">;</span><span class="w"></span>
<span class="linenos">15</span><span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="linenos">16</span><span class="p">};</span><span class="w"></span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">19</span><span class="w">  </span><span class="n">DataType</span><span class="w"> </span><span class="o">*</span><span class="n">initData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DataType</span><span class="p">();</span><span class="w">  </span><span class="c1">// main function owns it</span>
<span class="linenos">20</span><span class="w">  </span><span class="n">MyClass</span><span class="w"> </span><span class="n">obj1</span><span class="p">(</span><span class="n">initData</span><span class="p">);</span><span class="w">  </span><span class="c1">// obj1 owns it now</span>
<span class="linenos">21</span>
<span class="linenos">22</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos">23</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>You may also choose to remove the destructor and let the main function to delete
if you feel it make more sense that the recipients are only users of the dynamic
data. Sometimes the dynamic data is shared.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">class</span><span class="w"> </span><span class="nc">Configuration</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 2</span><span class="w">  </span><span class="c1">// ...</span>
<span class="linenos"> 3</span><span class="p">};</span><span class="w"></span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w"> </span><span class="k">private</span><span class="o">:</span><span class="w"></span>
<span class="linenos"> 7</span><span class="w">  </span><span class="n">Configuration</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w"> </span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">  </span><span class="n">MyClass</span><span class="p">(</span><span class="n">Configuration</span><span class="w"> </span><span class="o">*</span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">10</span><span class="w">    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">config</span><span class="p">;</span><span class="w"></span>
<span class="linenos">11</span><span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="linenos">12</span><span class="p">};</span><span class="w"></span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="w">  </span><span class="n">Configuration</span><span class="w"> </span><span class="o">*</span><span class="n">config1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Configuration</span><span class="p">();</span><span class="w">  </span><span class="c1">// main function owns it</span>
<span class="linenos">17</span><span class="w">  </span><span class="n">MyClass</span><span class="w"> </span><span class="n">obj1</span><span class="p">(</span><span class="n">config1</span><span class="p">);</span><span class="w">  </span><span class="c1">// obj1 uses it</span>
<span class="linenos">18</span><span class="w">  </span><span class="n">MyClass</span><span class="w"> </span><span class="n">obj2</span><span class="p">(</span><span class="n">config1</span><span class="p">);</span><span class="w">  </span><span class="c1">// obj2 uses it</span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="w">  </span><span class="k">delete</span><span class="w"> </span><span class="n">config1</span><span class="p">;</span><span class="w"></span>
<span class="linenos">21</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos">22</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The dynamic data can also be passed as a returned value.</p>
<p>Example: The object always owns the data. The recipient just used it.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 2</span><span class="w"> </span><span class="k">private</span><span class="o">:</span><span class="w"></span>
<span class="linenos"> 3</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">array</span><span class="p">;</span><span class="w">  </span><span class="c1">// always owned by the object</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 5</span><span class="w"> </span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w">  </span><span class="c1">// ... other methods</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="c1">// array is new&#39;ed in some methods</span>
<span class="linenos"> 8</span><span class="w">  </span><span class="o">~</span><span class="n">MyClass</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="n">array</span><span class="p">;}</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">getArray</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="k">return</span><span class="w"> </span><span class="n">array</span><span class="p">;}</span><span class="w">  </span><span class="c1">// expose to outside</span>
<span class="linenos">10</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">getSize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="k">return</span><span class="w"> </span><span class="n">size</span><span class="p">;}</span><span class="w"></span>
<span class="linenos">11</span><span class="p">};</span><span class="w"></span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">14</span><span class="w">  </span><span class="c1">// declare and initialize data in MyClass obj1;</span>
<span class="linenos">15</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obj1</span><span class="p">.</span><span class="n">getSize</span><span class="p">();</span><span class="w"></span>
<span class="linenos">16</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obj1</span><span class="p">.</span><span class="n">getArray</span><span class="p">();</span><span class="w"></span>
<span class="linenos">17</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="linenos">18</span><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">;</span><span class="w"></span>
<span class="linenos">19</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos">20</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Example: The ownership changed to the recipient.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos"> 2</span><span class="w"> </span><span class="k">private</span><span class="o">:</span><span class="w"></span>
<span class="linenos"> 3</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">array</span><span class="p">;</span><span class="w">  </span><span class="c1">// always owned by the object</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"></span>
<span class="linenos"> 5</span><span class="w"> </span><span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w">  </span><span class="c1">// ... other methods</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="c1">// array is new&#39;ed in some methods</span>
<span class="linenos"> 8</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">getPositiveValues</span><span class="p">();</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="nf">getPositiveCount</span><span class="p">();</span><span class="w"></span>
<span class="linenos">10</span><span class="p">};</span><span class="w"></span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">MyClass::getPositiveValues</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">13</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">posCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getPositiveCount</span><span class="p">();</span><span class="w"></span>
<span class="linenos">14</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="n">posCount</span><span class="p">];</span><span class="w">  </span><span class="c1">// dynamic data, not meant to be owned</span>
<span class="linenos">15</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos">16</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="linenos">17</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">18</span><span class="w">      </span><span class="n">arr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="w"></span>
<span class="linenos">19</span><span class="w">      </span><span class="n">j</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="linenos">20</span><span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="linenos">21</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">arr</span><span class="p">;</span><span class="w"></span>
<span class="linenos">22</span><span class="p">}</span><span class="w"></span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="kt">int</span><span class="w"> </span><span class="nf">MyClass::getPositiveCount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">25</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos">26</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="linenos">27</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="linenos">28</span><span class="w">      </span><span class="n">count</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="linenos">29</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">count</span><span class="p">;</span><span class="w"></span>
<span class="linenos">30</span><span class="p">}</span><span class="w"></span>
<span class="linenos">31</span>
<span class="linenos">32</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos">33</span><span class="w">  </span><span class="c1">// declare and initialize data in MyClass obj1;</span>
<span class="linenos">34</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">positiveArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obj1</span><span class="p">.</span><span class="n">getPositiveValues</span><span class="p">();</span><span class="w"></span>
<span class="linenos">35</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obj1</span><span class="p">.</span><span class="n">getPositiveCount</span><span class="p">();</span><span class="w"></span>
<span class="linenos">36</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"></span>
<span class="linenos">37</span><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">positiveArray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">;</span><span class="w"></span>
<span class="linenos">38</span><span class="w">  </span><span class="k">delete</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="n">positiveArray</span><span class="p">;</span><span class="w">  </span><span class="c1">// positiveArray owned by the main function</span>
<span class="linenos">39</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="linenos">40</span><span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Memory Management in Classes</a><ul>
<li><a class="reference internal" href="#dynamic-data-in-class">Dynamic data in class</a></li>
<li><a class="reference internal" href="#ownership-of-dynamic-data">Ownership of Dynamic Data</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="../../course/cop3014/ch09.html"
                          title="previous chapter">Chapter 9 Memory Management in Classes</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../op-overload.html"
                          title="next chapter">Operator Overloading</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/cpp/memory-man/memory-man-class.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../op-overload.html" title="Operator Overloading"
             >next</a> |</li>
        <li class="right" >
          <a href="../../course/cop3014/ch09.html" title="Chapter 9 Memory Management in Classes"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">IanFang Course Note Hosting  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../course/cop3014/index.html" >COP 3014 Algorithm and Program Design</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../course/cop3014/ch09.html" >Chapter 9 Memory Management in Classes</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Memory Management in Classes</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Ian Fang.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>